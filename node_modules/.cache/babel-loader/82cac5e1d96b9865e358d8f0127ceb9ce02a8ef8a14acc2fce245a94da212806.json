{"ast":null,"code":"import _objectSpread from\"/Users/harshkumar/Library/CloudStorage/OneDrive-IBM/X HK HK Psnl/00 A Personal/01 Ideas/BodyMap/Product/bodymap-final/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/lib/supabase.js\nimport{createClient}from'@supabase/supabase-js';const supabaseUrl=process.env.REACT_APP_SUPABASE_URL;const supabaseAnonKey=process.env.REACT_APP_SUPABASE_ANON_KEY;export const supabase=createClient(supabaseUrl,supabaseAnonKey);export const db={async getTherapistByUrl(customUrl){const{data,error}=await supabase.from('therapists').select('id, business_name, full_name').eq('custom_url',customUrl).single();if(error)throw error;return data;},async upsertClient(therapistId,clientData){const{data:existing}=await supabase.from('clients').select('*').eq('therapist_id',therapistId).eq('phone',clientData.phone).maybeSingle();if(existing)return existing;const{data,error}=await supabase.from('clients').insert([{therapist_id:therapistId,name:clientData.name,phone:clientData.phone,email:clientData.email||null}]).select().single();if(error)throw error;return data;},async createSession(sessionData){const{data,error}=await supabase.from('sessions').insert([sessionData]).select().single();if(error)throw error;return data;},async getTherapistSessions(therapistId){const{data,error}=await supabase.from('sessions').select('*, client:clients(*)').eq('therapist_id',therapistId).order('created_at',{ascending:false}).limit(100);if(error)throw error;return data;},async getSession(sessionId){const{data,error}=await supabase.from('sessions').select('*, client:clients(*)').eq('id',sessionId).single();if(error)throw error;return data;},async updateSession(sessionId,updates){const{data,error}=await supabase.from('sessions').update(updates).eq('id',sessionId).select().single();if(error)throw error;return data;},async getTherapistClients(therapistId){// Fetch clients with real session counts from the sessions table\nconst{data:clients,error}=await supabase.from('clients').select('*, sessions(id, completed)').eq('therapist_id',therapistId).order('created_at',{ascending:false});if(error)throw error;// Map to attach derived counts so components can use total_sessions directly\nreturn(clients||[]).map(c=>_objectSpread(_objectSpread({},c),{},{total_sessions:(c.sessions||[]).length,completed_sessions:(c.sessions||[]).filter(s=>s.completed).length}));},async getClientHistory(clientId){const{data,error}=await supabase.from('sessions').select('*').eq('client_id',clientId).order('created_at',{ascending:false});if(error)throw error;return data;}};","map":{"version":3,"names":["createClient","supabaseUrl","process","env","REACT_APP_SUPABASE_URL","supabaseAnonKey","REACT_APP_SUPABASE_ANON_KEY","supabase","db","getTherapistByUrl","customUrl","data","error","from","select","eq","single","upsertClient","therapistId","clientData","existing","phone","maybeSingle","insert","therapist_id","name","email","createSession","sessionData","getTherapistSessions","order","ascending","limit","getSession","sessionId","updateSession","updates","update","getTherapistClients","clients","map","c","_objectSpread","total_sessions","sessions","length","completed_sessions","filter","s","completed","getClientHistory","clientId"],"sources":["/Users/harshkumar/Library/CloudStorage/OneDrive-IBM/X HK HK Psnl/00 A Personal/01 Ideas/BodyMap/Product/bodymap-final/src/lib/supabase.js"],"sourcesContent":["// src/lib/supabase.js\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.REACT_APP_SUPABASE_URL;\nconst supabaseAnonKey = process.env.REACT_APP_SUPABASE_ANON_KEY;\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\nexport const db = {\n  async getTherapistByUrl(customUrl) {\n    const { data, error } = await supabase\n      .from('therapists')\n      .select('id, business_name, full_name')\n      .eq('custom_url', customUrl)\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async upsertClient(therapistId, clientData) {\n    const { data: existing } = await supabase\n      .from('clients')\n      .select('*')\n      .eq('therapist_id', therapistId)\n      .eq('phone', clientData.phone)\n      .maybeSingle();\n    if (existing) return existing;\n    const { data, error } = await supabase\n      .from('clients')\n      .insert([{ therapist_id: therapistId, name: clientData.name, phone: clientData.phone, email: clientData.email || null }])\n      .select()\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async createSession(sessionData) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .insert([sessionData])\n      .select()\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async getTherapistSessions(therapistId) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .select('*, client:clients(*)')\n      .eq('therapist_id', therapistId)\n      .order('created_at', { ascending: false })\n      .limit(100);\n    if (error) throw error;\n    return data;\n  },\n\n  async getSession(sessionId) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .select('*, client:clients(*)')\n      .eq('id', sessionId)\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async updateSession(sessionId, updates) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .update(updates)\n      .eq('id', sessionId)\n      .select()\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async getTherapistClients(therapistId) {\n    // Fetch clients with real session counts from the sessions table\n    const { data: clients, error } = await supabase\n      .from('clients')\n      .select('*, sessions(id, completed)')\n      .eq('therapist_id', therapistId)\n      .order('created_at', { ascending: false });\n    if (error) throw error;\n\n    // Map to attach derived counts so components can use total_sessions directly\n    return (clients || []).map(c => ({\n      ...c,\n      total_sessions: (c.sessions || []).length,\n      completed_sessions: (c.sessions || []).filter(s => s.completed).length,\n    }));\n  },\n\n  async getClientHistory(clientId) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .select('*')\n      .eq('client_id', clientId)\n      .order('created_at', { ascending: false });\n    if (error) throw error;\n    return data;\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}