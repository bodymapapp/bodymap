{"ast":null,"code":"// src/lib/supabase.js\nimport { createClient } from '@supabase/supabase-js';\nconst supabaseUrl = process.env.REACT_APP_SUPABASE_URL;\nconst supabaseAnonKey = process.env.REACT_APP_SUPABASE_ANON_KEY;\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\nexport const db = {\n  async getTherapistByUrl(customUrl) {\n    const {\n      data,\n      error\n    } = await supabase.from('therapists').select('id, business_name, full_name').eq('custom_url', customUrl).single();\n    if (error) throw error;\n    return data;\n  },\n  async upsertClient(therapistId, clientData) {\n    const {\n      data: existing\n    } = await supabase.from('clients').select('*').eq('therapist_id', therapistId).eq('phone', clientData.phone).maybeSingle();\n    if (existing) return existing;\n    const {\n      data,\n      error\n    } = await supabase.from('clients').insert([{\n      therapist_id: therapistId,\n      name: clientData.name,\n      phone: clientData.phone,\n      email: clientData.email || null\n    }]).select().single();\n    if (error) throw error;\n    return data;\n  },\n  async createSession(sessionData) {\n    const {\n      data,\n      error\n    } = await supabase.from('sessions').insert([sessionData]).select().single();\n    if (error) throw error;\n    return data;\n  },\n  async getTherapistSessions(therapistId) {\n    const {\n      data,\n      error\n    } = await supabase.from('sessions').select('*, client:clients(*)').eq('therapist_id', therapistId).order('created_at', {\n      ascending: false\n    }).limit(100);\n    if (error) throw error;\n    return data;\n  },\n  async getSession(sessionId) {\n    const {\n      data,\n      error\n    } = await supabase.from('sessions').select('*, client:clients(*)').eq('id', sessionId).single();\n    if (error) throw error;\n    return data;\n  },\n  async updateSession(sessionId, updates) {\n    const {\n      data,\n      error\n    } = await supabase.from('sessions').update(updates).eq('id', sessionId).select().single();\n    if (error) throw error;\n    return data;\n  },\n  async getTherapistClients(therapistId) {\n    // Fetch clients with real session counts from the sessions table\n    const {\n      data: clients,\n      error\n    } = await supabase.from('clients').select('*, sessions(id, completed, created_at)').eq('therapist_id', therapistId).order('created_at', {\n      ascending: false\n    });\n    if (error) throw error;\n    return (clients || []).map(c => {\n      const sessions = c.sessions || [];\n      const sorted = [...sessions].sort((a, b) => new Date(b.created_at) - new Date(a.created_at));\n      const lastSession = sorted[0];\n      const daysSince = lastSession ? Math.floor((Date.now() - new Date(lastSession.created_at)) / 86400000) : null;\n      const pending = sessions.filter(s => !s.completed);\n      // Only flag as \"today's focus\" if intake submitted within 48 hours\n      const recentPending = pending.filter(s => {\n        const hrs = (Date.now() - new Date(s.created_at)) / 3600000;\n        return hrs <= 48;\n      });\n      return {\n        ...c,\n        total_sessions: sessions.length,\n        completed_sessions: sessions.filter(s => s.completed).length,\n        last_session_at: (lastSession === null || lastSession === void 0 ? void 0 : lastSession.created_at) || null,\n        days_since_visit: daysSince,\n        has_pending: recentPending.length > 0,\n        has_old_pending: pending.length > recentPending.length\n      };\n    });\n  },\n  async getFeedback(sessionId) {\n    const {\n      data,\n      error\n    } = await supabase.from(\"feedback\").select(\"*\").eq(\"session_id\", sessionId).maybeSingle();\n    if (error) throw error;\n    return data;\n  },\n  async getClientHistory(clientId) {\n    const {\n      data,\n      error\n    } = await supabase.from('sessions').select('*').eq('client_id', clientId).order('created_at', {\n      ascending: false\n    });\n    if (error) throw error;\n    return data;\n  }\n};","map":{"version":3,"names":["createClient","supabaseUrl","process","env","REACT_APP_SUPABASE_URL","supabaseAnonKey","REACT_APP_SUPABASE_ANON_KEY","supabase","db","getTherapistByUrl","customUrl","data","error","from","select","eq","single","upsertClient","therapistId","clientData","existing","phone","maybeSingle","insert","therapist_id","name","email","createSession","sessionData","getTherapistSessions","order","ascending","limit","getSession","sessionId","updateSession","updates","update","getTherapistClients","clients","map","c","sessions","sorted","sort","a","b","Date","created_at","lastSession","daysSince","Math","floor","now","pending","filter","s","completed","recentPending","hrs","total_sessions","length","completed_sessions","last_session_at","days_since_visit","has_pending","has_old_pending","getFeedback","getClientHistory","clientId"],"sources":["/Users/harshkumar/Documents/bodymap/src/lib/supabase.js"],"sourcesContent":["// src/lib/supabase.js\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.REACT_APP_SUPABASE_URL;\nconst supabaseAnonKey = process.env.REACT_APP_SUPABASE_ANON_KEY;\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\nexport const db = {\n  async getTherapistByUrl(customUrl) {\n    const { data, error } = await supabase\n      .from('therapists')\n      .select('id, business_name, full_name')\n      .eq('custom_url', customUrl)\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async upsertClient(therapistId, clientData) {\n    const { data: existing } = await supabase\n      .from('clients')\n      .select('*')\n      .eq('therapist_id', therapistId)\n      .eq('phone', clientData.phone)\n      .maybeSingle();\n    if (existing) return existing;\n    const { data, error } = await supabase\n      .from('clients')\n      .insert([{ therapist_id: therapistId, name: clientData.name, phone: clientData.phone, email: clientData.email || null }])\n      .select()\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async createSession(sessionData) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .insert([sessionData])\n      .select()\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async getTherapistSessions(therapistId) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .select('*, client:clients(*)')\n      .eq('therapist_id', therapistId)\n      .order('created_at', { ascending: false })\n      .limit(100);\n    if (error) throw error;\n    return data;\n  },\n\n  async getSession(sessionId) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .select('*, client:clients(*)')\n      .eq('id', sessionId)\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async updateSession(sessionId, updates) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .update(updates)\n      .eq('id', sessionId)\n      .select()\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async getTherapistClients(therapistId) {\n    // Fetch clients with real session counts from the sessions table\n    const { data: clients, error } = await supabase\n      .from('clients')\n      .select('*, sessions(id, completed, created_at)')\n      .eq('therapist_id', therapistId)\n      .order('created_at', { ascending: false });\n    if (error) throw error;\n\n    return (clients || []).map(c => {\n      const sessions = c.sessions || [];\n      const sorted = [...sessions].sort((a,b) => new Date(b.created_at) - new Date(a.created_at));\n      const lastSession = sorted[0];\n      const daysSince = lastSession ? Math.floor((Date.now() - new Date(lastSession.created_at)) / 86400000) : null;\n      const pending = sessions.filter(s => !s.completed);\n      // Only flag as \"today's focus\" if intake submitted within 48 hours\n      const recentPending = pending.filter(s => {\n        const hrs = (Date.now() - new Date(s.created_at)) / 3600000;\n        return hrs <= 48;\n      });\n      return {\n        ...c,\n        total_sessions: sessions.length,\n        completed_sessions: sessions.filter(s => s.completed).length,\n        last_session_at: lastSession?.created_at || null,\n        days_since_visit: daysSince,\n        has_pending: recentPending.length > 0,\n        has_old_pending: pending.length > recentPending.length,\n      };\n    });\n  },\n\n  async getFeedback(sessionId) {\n    const { data, error } = await supabase.from(\"feedback\").select(\"*\").eq(\"session_id\", sessionId).maybeSingle();\n    if (error) throw error;\n    return data;\n  },\n\n  async getClientHistory(clientId) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .select('*')\n      .eq('client_id', clientId)\n      .order('created_at', { ascending: false });\n    if (error) throw error;\n    return data;\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}