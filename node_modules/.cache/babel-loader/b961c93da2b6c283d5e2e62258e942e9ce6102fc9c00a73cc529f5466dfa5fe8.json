{"ast":null,"code":"// src/contexts/AuthContext.js\nimport React,{createContext,useState,useEffect,useContext}from'react';import{supabase}from'../lib/supabase';import{jsx as _jsx}from\"react/jsx-runtime\";const AuthContext=/*#__PURE__*/createContext({});export const useAuth=()=>useContext(AuthContext);export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[therapist,setTherapist]=useState(null);const[loading,setLoading]=useState(true);useEffect(()=>{supabase.auth.getSession().then(_ref2=>{let{data:{session}}=_ref2;if(session!==null&&session!==void 0&&session.user){setUser(session.user);supabase.from('therapists').select('*').eq('id',session.user.id).single().then(_ref3=>{let{data}=_ref3;if(data)setTherapist(data);}).finally(()=>setLoading(false));}else{setLoading(false);}}).catch(()=>setLoading(false));const{data:{subscription}}=supabase.auth.onAuthStateChange((_event,session)=>{if(session!==null&&session!==void 0&&session.user){setUser(session.user);supabase.from('therapists').select('*').eq('id',session.user.id).single().then(_ref4=>{let{data}=_ref4;if(data)setTherapist(data);});}else{setUser(null);setTherapist(null);}});return()=>subscription.unsubscribe();},[]);const signIn=async(email,password)=>{try{const{data,error}=await supabase.auth.signInWithPassword({email,password});if(error)throw error;setUser(data.user);const{data:t}=await supabase.from('therapists').select('*').eq('id',data.user.id).single();if(t)setTherapist(t);return{success:true};}catch(error){return{success:false,error:error.message};}};const signOut=async()=>{await supabase.auth.signOut();setUser(null);setTherapist(null);window.location.href='/login';};const signUp=async(email,password,metadata)=>{try{const{data:authData,error:authError}=await supabase.auth.signUp({email,password});if(authError)throw authError;const{error:dbError}=await supabase.from('therapists').insert([{id:authData.user.id,email,business_name:metadata.businessName,full_name:metadata.fullName,phone:metadata.phone,custom_url:metadata.customUrl,password_hash:'managed_by_supabase_auth',plan:'free'}]);if(dbError)throw dbError;return{success:true};}catch(error){return{success:false,error:error.message};}};const updateProfile=async updates=>{try{const{data,error}=await supabase.from('therapists').update(updates).eq('id',user.id).select().single();if(error)throw error;setTherapist(data);return{success:true,data};}catch(error){return{success:false,error:error.message};}};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:{user,therapist,loading,signIn,signOut,signUp,updateProfile,isAuthenticated:!!user},children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","useContext","supabase","jsx","_jsx","AuthContext","useAuth","AuthProvider","_ref","children","user","setUser","therapist","setTherapist","loading","setLoading","auth","getSession","then","_ref2","data","session","from","select","eq","id","single","_ref3","finally","catch","subscription","onAuthStateChange","_event","_ref4","unsubscribe","signIn","email","password","error","signInWithPassword","t","success","message","signOut","window","location","href","signUp","metadata","authData","authError","dbError","insert","business_name","businessName","full_name","fullName","phone","custom_url","customUrl","password_hash","plan","updateProfile","updates","update","Provider","value","isAuthenticated"],"sources":["/Users/harshkumar/Library/CloudStorage/OneDrive-IBM/X HK HK Psnl/00 A Personal/01 Ideas/BodyMap/Product/bodymap-final/src/contexts/AuthContext.js"],"sourcesContent":["// src/contexts/AuthContext.js\nimport React, { createContext, useState, useEffect, useContext } from 'react';\nimport { supabase } from '../lib/supabase';\n\nconst AuthContext = createContext({});\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [therapist, setTherapist] = useState(null);\n  const [loading, setLoading] = useState(true);\n\n  useEffect(() => {\n    supabase.auth.getSession().then(({ data: { session } }) => {\n      if (session?.user) {\n        setUser(session.user);\n        supabase.from('therapists').select('*').eq('id', session.user.id).single()\n          .then(({ data }) => { if (data) setTherapist(data); })\n          .finally(() => setLoading(false));\n      } else {\n        setLoading(false);\n      }\n    }).catch(() => setLoading(false));\n\n    const { data: { subscription } } = supabase.auth.onAuthStateChange((_event, session) => {\n      if (session?.user) {\n        setUser(session.user);\n        supabase.from('therapists').select('*').eq('id', session.user.id).single()\n          .then(({ data }) => { if (data) setTherapist(data); });\n      } else {\n        setUser(null);\n        setTherapist(null);\n      }\n    });\n\n    return () => subscription.unsubscribe();\n  }, []);\n\n  const signIn = async (email, password) => {\n    try {\n      const { data, error } = await supabase.auth.signInWithPassword({ email, password });\n      if (error) throw error;\n      setUser(data.user);\n      const { data: t } = await supabase.from('therapists').select('*').eq('id', data.user.id).single();\n      if (t) setTherapist(t);\n      return { success: true };\n    } catch (error) {\n      return { success: false, error: error.message };\n    }\n  };\n\n  const signOut = async () => {\n    await supabase.auth.signOut();\n    setUser(null);\n    setTherapist(null);\n    window.location.href = '/login';\n  };\n\n  const signUp = async (email, password, metadata) => {\n    try {\n      const { data: authData, error: authError } = await supabase.auth.signUp({ email, password });\n      if (authError) throw authError;\n      const { error: dbError } = await supabase.from('therapists').insert([{\n        id: authData.user.id, email,\n        business_name: metadata.businessName,\n        full_name: metadata.fullName,\n        phone: metadata.phone,\n        custom_url: metadata.customUrl,\n        password_hash: 'managed_by_supabase_auth',\n        plan: 'free'\n      }]);\n      if (dbError) throw dbError;\n      return { success: true };\n    } catch (error) {\n      return { success: false, error: error.message };\n    }\n  };\n\n  const updateProfile = async (updates) => {\n    try {\n      const { data, error } = await supabase.from('therapists').update(updates).eq('id', user.id).select().single();\n      if (error) throw error;\n      setTherapist(data);\n      return { success: true, data };\n    } catch (error) {\n      return { success: false, error: error.message };\n    }\n  };\n\n  return (\n    <AuthContext.Provider value={{ user, therapist, loading, signIn, signOut, signUp, updateProfile, isAuthenticated: !!user }}>\n      {children}\n    </AuthContext.Provider>\n  );\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}