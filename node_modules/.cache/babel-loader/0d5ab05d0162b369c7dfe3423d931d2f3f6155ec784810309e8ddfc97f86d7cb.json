{"ast":null,"code":"import _objectSpread from\"/Users/harshkumar/Documents/bodymap/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/lib/supabase.js\nimport{createClient}from'@supabase/supabase-js';const supabaseUrl=process.env.REACT_APP_SUPABASE_URL;const supabaseAnonKey=process.env.REACT_APP_SUPABASE_ANON_KEY;export const supabase=createClient(supabaseUrl,supabaseAnonKey);export const db={async getTherapistByUrl(customUrl){const{data,error}=await supabase.from('therapists').select('id, business_name, full_name').eq('custom_url',customUrl).single();if(error)throw error;return data;},async upsertClient(therapistId,clientData){const{data:existing}=await supabase.from('clients').select('*').eq('therapist_id',therapistId).eq('phone',clientData.phone).maybeSingle();if(existing)return existing;const{data,error}=await supabase.from('clients').insert([{therapist_id:therapistId,name:clientData.name,phone:clientData.phone,email:clientData.email||null}]).select().single();if(error)throw error;return data;},async createSession(sessionData){const{data,error}=await supabase.from('sessions').insert([sessionData]).select().single();if(error)throw error;return data;},async getTherapistSessions(therapistId){const{data,error}=await supabase.from('sessions').select('*, client:clients(*)').eq('therapist_id',therapistId).order('created_at',{ascending:false}).limit(100);if(error)throw error;return data;},async getSession(sessionId){const{data,error}=await supabase.from('sessions').select('*, client:clients(*)').eq('id',sessionId).single();if(error)throw error;return data;},async updateSession(sessionId,updates){const{data,error}=await supabase.from('sessions').update(updates).eq('id',sessionId).select().single();if(error)throw error;return data;},async getTherapistClients(therapistId){// Fetch clients with real session counts from the sessions table\nconst{data:clients,error}=await supabase.from('clients').select('*, sessions(id, completed, created_at)').eq('therapist_id',therapistId).order('created_at',{ascending:false});if(error)throw error;return(clients||[]).map(c=>{const sessions=c.sessions||[];const sorted=[...sessions].sort((a,b)=>new Date(b.created_at)-new Date(a.created_at));const lastSession=sorted[0];const daysSince=lastSession?Math.floor((Date.now()-new Date(lastSession.created_at))/86400000):null;const pending=sessions.filter(s=>!s.completed);// Only flag as \"today's focus\" if intake submitted within 48 hours\nconst recentPending=pending.filter(s=>{const hrs=(Date.now()-new Date(s.created_at))/3600000;return hrs<=48;});return _objectSpread(_objectSpread({},c),{},{total_sessions:sessions.length,completed_sessions:sessions.filter(s=>s.completed).length,last_session_at:(lastSession===null||lastSession===void 0?void 0:lastSession.created_at)||null,days_since_visit:daysSince,has_pending:recentPending.length>0,has_old_pending:pending.length>recentPending.length});});},async getFeedback(sessionId){const{data,error}=await supabase.from(\"feedback\").select(\"*\").eq(\"session_id\",sessionId).maybeSingle();if(error)throw error;return data;},async getClientHistory(clientId){const{data,error}=await supabase.from('sessions').select('*').eq('client_id',clientId).order('created_at',{ascending:false});if(error)throw error;return data;}};","map":{"version":3,"names":["createClient","supabaseUrl","process","env","REACT_APP_SUPABASE_URL","supabaseAnonKey","REACT_APP_SUPABASE_ANON_KEY","supabase","db","getTherapistByUrl","customUrl","data","error","from","select","eq","single","upsertClient","therapistId","clientData","existing","phone","maybeSingle","insert","therapist_id","name","email","createSession","sessionData","getTherapistSessions","order","ascending","limit","getSession","sessionId","updateSession","updates","update","getTherapistClients","clients","map","c","sessions","sorted","sort","a","b","Date","created_at","lastSession","daysSince","Math","floor","now","pending","filter","s","completed","recentPending","hrs","_objectSpread","total_sessions","length","completed_sessions","last_session_at","days_since_visit","has_pending","has_old_pending","getFeedback","getClientHistory","clientId"],"sources":["/Users/harshkumar/Documents/bodymap/src/lib/supabase.js"],"sourcesContent":["// src/lib/supabase.js\nimport { createClient } from '@supabase/supabase-js';\n\nconst supabaseUrl = process.env.REACT_APP_SUPABASE_URL;\nconst supabaseAnonKey = process.env.REACT_APP_SUPABASE_ANON_KEY;\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\nexport const db = {\n  async getTherapistByUrl(customUrl) {\n    const { data, error } = await supabase\n      .from('therapists')\n      .select('id, business_name, full_name')\n      .eq('custom_url', customUrl)\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async upsertClient(therapistId, clientData) {\n    const { data: existing } = await supabase\n      .from('clients')\n      .select('*')\n      .eq('therapist_id', therapistId)\n      .eq('phone', clientData.phone)\n      .maybeSingle();\n    if (existing) return existing;\n    const { data, error } = await supabase\n      .from('clients')\n      .insert([{ therapist_id: therapistId, name: clientData.name, phone: clientData.phone, email: clientData.email || null }])\n      .select()\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async createSession(sessionData) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .insert([sessionData])\n      .select()\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async getTherapistSessions(therapistId) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .select('*, client:clients(*)')\n      .eq('therapist_id', therapistId)\n      .order('created_at', { ascending: false })\n      .limit(100);\n    if (error) throw error;\n    return data;\n  },\n\n  async getSession(sessionId) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .select('*, client:clients(*)')\n      .eq('id', sessionId)\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async updateSession(sessionId, updates) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .update(updates)\n      .eq('id', sessionId)\n      .select()\n      .single();\n    if (error) throw error;\n    return data;\n  },\n\n  async getTherapistClients(therapistId) {\n    // Fetch clients with real session counts from the sessions table\n    const { data: clients, error } = await supabase\n      .from('clients')\n      .select('*, sessions(id, completed, created_at)')\n      .eq('therapist_id', therapistId)\n      .order('created_at', { ascending: false });\n    if (error) throw error;\n\n    return (clients || []).map(c => {\n      const sessions = c.sessions || [];\n      const sorted = [...sessions].sort((a,b) => new Date(b.created_at) - new Date(a.created_at));\n      const lastSession = sorted[0];\n      const daysSince = lastSession ? Math.floor((Date.now() - new Date(lastSession.created_at)) / 86400000) : null;\n      const pending = sessions.filter(s => !s.completed);\n      // Only flag as \"today's focus\" if intake submitted within 48 hours\n      const recentPending = pending.filter(s => {\n        const hrs = (Date.now() - new Date(s.created_at)) / 3600000;\n        return hrs <= 48;\n      });\n      return {\n        ...c,\n        total_sessions: sessions.length,\n        completed_sessions: sessions.filter(s => s.completed).length,\n        last_session_at: lastSession?.created_at || null,\n        days_since_visit: daysSince,\n        has_pending: recentPending.length > 0,\n        has_old_pending: pending.length > recentPending.length,\n      };\n    });\n  },\n\n  async getFeedback(sessionId) {\n    const { data, error } = await supabase.from(\"feedback\").select(\"*\").eq(\"session_id\", sessionId).maybeSingle();\n    if (error) throw error;\n    return data;\n  },\n\n  async getClientHistory(clientId) {\n    const { data, error } = await supabase\n      .from('sessions')\n      .select('*')\n      .eq('client_id', clientId)\n      .order('created_at', { ascending: false });\n    if (error) throw error;\n    return data;\n  }\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}